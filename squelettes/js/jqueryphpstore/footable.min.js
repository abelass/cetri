/*!
 * FooTable - Awesome Responsive Tables
 * Version : 0.5
 * http://themergency.com/footable
 *
 * Requires jQuery - http://jquery.com/
 *
 * Copyright 2012 Steven Usher & Brad Vincent
 * Released under the MIT license
 * You are free to use FooTable in commercial projects as long as this copyright header is left intact.
 *
 * Date: 22 Apr 2013
 */
(function(d,a,f){a.footable={options:{delay:100,breakpoints:{phone:480,tablet:1024},parsers:{alpha:function(g){return d(g).data("value")||d.trim(d(g).text())},numeric:function(g){var h=d(g).data("value")||d(g).text().replace(/[^0-9.\-]/g,"");h=parseFloat(h);if(isNaN(h)){h=0}return h}},calculateWidthAndHeightOverride:null,toggleSelector:" > tbody > tr:not(.footable-row-detail)",columnDataSelector:"> thead > tr:last-child > th, > thead > tr:last-child > td",detailSeparator:":",createGroupedDetail:function(k){var g={_none:{name:null,data:[]}};for(var j=0;j<k.length;j++){var h=k[j].group;if(h!==null){if(!(h in g)){g[h]={name:k[j].groupName||k[j].group,data:[]}}g[h].data.push(k[j])}else{g._none.data.push(k[j])}}return g},createDetail:function(m,l,p,k,h){var g=p(l);for(var o in g){if(g[o].data.length===0){continue}if(o!=="_none"){m.append('<div class="'+h.detailInnerGroup+'">'+g[o].name+"</div>")}for(var i=0;i<g[o].data.length;i++){var n=(g[o].data[i].name)?k:"";m.append('<div class="'+h.detailInnerRow+'"><div class="'+h.detailInnerName+'">'+g[o].data[i].name+n+'</div><div class="'+h.detailInnerValue+'">'+g[o].data[i].display+"</div></div>")}}},classes:{main:"footable",loading:"footable-loading",loaded:"footable-loaded",toggle:"footable-toggle",detail:"footable-row-detail",detailCell:"footable-row-detail-cell",detailInner:"footable-row-detail-inner",detailInnerRow:"footable-row-detail-row",detailInnerGroup:"footable-row-detail-group",detailInnerName:"footable-row-detail-name",detailInnerValue:"footable-row-detail-value",detailShow:"footable-detail-show"},triggers:{initialize:"footable_initialize",resize:"footable_resize",redraw:"footable_redraw",toggleRow:"footable_toggle_row",expandFirstRow:"footable_expand_first_row"},events:{alreadyInitialized:"footable_already_initialized",initializing:"footable_initializing",initialized:"footable_initialized",resizing:"footable_resizing",resized:"footable_resized",breakpoint:"footable_breakpoint",columnData:"footable_column_data",rowDetailUpdating:"footable_row_detail_updating",rowDetailUpdated:"footable_row_detail_updated",rowCollapsed:"footable_row_collapsed",rowExpanded:"footable_row_expanded"},debug:false,log:null},version:{major:0,minor:5,toString:function(){return a.footable.version.major+"."+a.footable.version.minor},parse:function(g){version=/(\d+)\.?(\d+)?\.?(\d+)?/.exec(g);return{major:parseInt(version[1],10)||0,minor:parseInt(version[2],10)||0,patch:parseInt(version[3],10)||0}}},plugins:{_validate:function(g){if(typeof g.name!=="string"){if(a.footable.options.debug===true){console.error('Validation failed, plugin does not implement a string property called "name".',g)}return false}if(!d.isFunction(g.init)){if(a.footable.options.debug===true){console.error('Validation failed, plugin "'+g.name+'" does not implement a function called "init".',g)}return false}if(a.footable.options.debug===true){console.log('Validation succeeded for plugin "'+g.name+'".',g)}return true},registered:[],register:function(h,g){if(a.footable.plugins._validate(h)){a.footable.plugins.registered.push(h);if(g!==f&&typeof g==="object"){d.extend(true,a.footable.options,g)}if(a.footable.options.debug===true){console.log('Plugin "'+h.name+'" has been registered with the Foobox.',h)}}},init:function(g){for(var h=0;h<a.footable.plugins.registered.length;h++){try{a.footable.plugins.registered[h]["init"](g)}catch(j){if(a.footable.options.debug===true){console.error(j)}}}}}};var c=0;d.fn.footable=function(g){g=g||{};var h=d.extend(true,{},a.footable.options,g);return this.each(function(){c++;this.footable=new e(this,h,c)})};function b(){var g=this;g.id=null;g.busy=false;g.start=function(i,h){if(g.busy){return}g.stop();g.id=setTimeout(function(){i();g.id=null;g.busy=false},h);g.busy=true};g.stop=function(){if(g.id!==null){clearTimeout(g.id);g.id=null;g.busy=false}}}function e(n,j,h){var l=this;l.id=h;l.table=n;l.options=j;l.breakpoints=[];l.breakpointNames="";l.columns={};var i=l.options,p=i.classes,m=i.events,g=i.triggers,k=0;l.timers={resize:new b(),register:function(o){l.timers[o]=new b();return l.timers[o]}};a.footable.plugins.init(l);l.init=function(){var r=d(a),q=d(l.table);if(q.hasClass(p.loaded)){l.raise(m.alreadyInitialized);return}l.raise(m.initializing);q.addClass(p.loading);q.find(i.columnDataSelector).each(function(){var s=l.getColumnData(this);l.columns[s.index]=s});for(var o in i.breakpoints){l.breakpoints.push({name:o,width:i.breakpoints[o]});l.breakpointNames+=(o+" ")}l.breakpoints.sort(function(t,s){return t.width-s.width});q.bind(g.initialize,function(){q.removeData("footable_info");q.data("breakpoint","");l.addRowToggle();l.bindToggleSelectors();l.setColumnClasses();q.removeClass(p.loading);q.addClass(p.loaded).addClass(p.main);q.trigger(g.resize);l.raise(m.initialized)}).bind(g.redraw,function(){l.redraw()}).bind(g.resize,function(){l.resize()}).bind(g.expandFirstRow,function(){q.find(i.toggleSelector).first().not("."+p.detailShow).trigger(g.toggleRow)});q.trigger(g.initialize);r.bind("resize.footable",function(){l.timers.resize.stop();l.timers.resize.start(function(){l.raise(g.resize)},i.delay)})};l.addRowToggle=function(){var r=d(l.table),t=false;r.find("span."+p.toggle).remove();for(var s in l.columns){var q=l.columns[s];if(q.toggle){t=true;var o="> tbody > tr:not(."+p.detail+") > td:nth-child("+(parseInt(q.index,10)+1)+")";r.find(o).not("."+p.detailCell).prepend(d("<span />").addClass(p.toggle));return}}if(!t){r.find("> tbody > tr:not(."+p.detail+") > td:first-child").not("."+p.detailCell).prepend(d("<span />").addClass(p.toggle))}};l.setColumnClasses=function(){$table=d(l.table);for(var s in l.columns){var q=l.columns[s];if(q.className!==null){var o="",r=true;d.each(q.matches,function(t,u){if(!r){o+=", "}o+="> tbody > tr:not(."+p.detail+") > td:nth-child("+(parseInt(u,10)+1)+")";r=false});$table.find(o).not("."+p.detailCell).addClass(q.className)}}};l.bindToggleSelectors=function(){var o=d(l.table);if(!l.hasAnyBreakpointColumn()){return}o.find(i.toggleSelector).unbind(g.toggleRow).bind(g.toggleRow,function(r){var q=d(this).is("tr")?d(this):d(this).parents("tr:first");l.toggleDetail(q.get(0))});o.find(i.toggleSelector).unbind("click.footable").bind("click.footable",function(q){if(o.is(".breakpoint")&&d(q.target).is("td,.footable-toggle")){d(this).trigger(g.toggleRow)}})};l.parse=function(o,q){var r=i.parsers[q.type]||i.parsers.alpha;return r(o)};l.getColumnData=function(q){var C=d(q),x=C.data("hide"),y=C.index();x=x||"";x=x.split(",");var w={index:y,hide:{},type:C.data("type")||"alpha",name:C.data("name")||d.trim(C.text()),ignore:C.data("ignore")||false,toggle:C.data("toggle")||false,className:C.data("class")||null,matches:[],names:{},group:C.data("group")||null,groupName:null};if(w.group!==null){var B=d(l.table).find('> thead > tr.footable-group-row > th[data-group="'+w.group+'"], > thead > tr.footable-group-row > td[data-group="'+w.group+'"]').first();w.groupName=l.parse(B,{type:"alpha"})}var r=parseInt(C.prev().attr("colspan")||0,10);k+=r>1?r-1:0;var s=parseInt(C.attr("colspan")||0,10),u=w.index+k;if(s>1){var A=C.data("names");A=A||"";A=A.split(",");for(var v=0;v<s;v++){w.matches.push(v+u);if(v<A.length){w.names[v+u]=A[v]}}}else{w.matches.push(u)}w.hide["default"]=(C.data("hide")==="all")||(d.inArray("default",x)>=0);var t=false;for(var o in i.breakpoints){w.hide[o]=(C.data("hide")==="all")||(d.inArray(o,x)>=0);t=t||w.hide[o]}w.hasBreakpoint=t;var z=l.raise(m.columnData,{column:{data:w,th:q}});return z.column.data};l.getViewportWidth=function(){return window.innerWidth||(document.body?document.body.offsetWidth:0)};l.getViewportHeight=function(){return window.innerHeight||(document.body?document.body.offsetHeight:0)};l.calculateWidthAndHeight=function(o,q){if(jQuery.isFunction(i.calculateWidthAndHeightOverride)){return i.calculateWidthAndHeightOverride(o,q)}if(q.viewportWidth<q.width){q.width=q.viewportWidth}if(q.viewportHeight<q.height){q.height=q.viewportHeight}return q};l.hasBreakpointColumn=function(o){for(var q in l.columns){if(l.columns[q].hide[o]){if(l.columns[q].ignore){continue}return true}}return false};l.hasAnyBreakpointColumn=function(){for(var o in l.columns){if(l.columns[o].hasBreakpoint&&!l.columns[o].ignore){return true}}return false};l.resize=function(){var x=d(l.table);if(!x.is(":visible")){return}if(!l.hasAnyBreakpointColumn()){return}var q={width:x.width(),height:x.height(),viewportWidth:l.getViewportWidth(),viewportHeight:l.getViewportHeight(),orientation:null};q.orientation=q.viewportWidth>q.viewportHeight?"landscape":"portrait";q=l.calculateWidthAndHeight(x,q);var s=x.data("footable_info");x.data("footable_info",q);l.raise(m.resizing,{old:s,info:q});if(!s||((s&&s.width&&s.width!==q.width)||(s&&s.height&&s.height!==q.height))){var t=null,v;for(var r=0;r<l.breakpoints.length;r++){v=l.breakpoints[r];if(v&&v.width&&q.width<=v.width){t=v;break}}var w=(t===null?"default":t.name),o=l.hasBreakpointColumn(w),u=x.data("breakpoint");x.data("breakpoint",w).removeClass("default breakpoint").removeClass(l.breakpointNames).addClass(w+(o?" breakpoint":""));if(w!==u){x.trigger(g.redraw);l.raise(m.breakpoint,{breakpoint:w,info:q})}}l.raise(m.resized,{old:s,info:q})};l.redraw=function(){var o=d(l.table),q=o.data("breakpoint"),r=l.hasBreakpointColumn(q);o.find("> tbody > tr:not(."+p.detail+")").data("detail_created",false).end().find("> thead > tr:last-child > th").each(function(){var w=l.columns[d(this).index()],s="",y=true;d.each(w.matches,function(z,A){if(!y){s+=", "}var B=A+1;s+="> tbody > tr:not(."+p.detail+") > td:nth-child("+B+")";s+=", > tfoot > tr:not(."+p.detail+") > td:nth-child("+B+")";s+=", > colgroup > col:nth-child("+B+")";y=false});s+=', > thead > tr[data-group-row="true"] > th[data-group="'+w.group+'"]';var x=o.find(s).add(this);if(w.hide[q]===false){x.show()}else{x.hide()}if(o.find("> thead > tr.footable-group-row").length===1){var u=o.find('> thead > tr:last-child > th[data-group="'+w.group+'"]:visible, > thead > tr:last-child > th[data-group="'+w.group+'"]:visible'),v=o.find('> thead > tr.footable-group-row > th[data-group="'+w.group+'"], > thead > tr.footable-group-row > td[data-group="'+w.group+'"]'),t=0;d.each(u,function(){t+=parseInt(d(this).attr("colspan")||1,10)});if(t>0){v.attr("colspan",t).show()}else{v.hide()}}}).end().find("> tbody > tr."+p.detailShow).each(function(){l.createOrUpdateDetailRow(this)});o.find("> tbody > tr."+p.detailShow+":visible").each(function(){var s=d(this).next();if(s.hasClass(p.detail)){if(!r){s.hide()}else{s.show()}}});o.find("> thead > tr > th.footable-last-column, > tbody > tr > td.footable-last-column").removeClass("footable-last-column");o.find("> thead > tr > th.footable-first-column, > tbody > tr > td.footable-first-column").removeClass("footable-first-column");o.find("> thead > tr, > tbody > tr").find("> th:visible:last, > td:visible:last").addClass("footable-last-column").end().find("> th:visible:first, > td:visible:first").addClass("footable-first-column")};l.toggleDetail=function(r){var o=d(r),q=o.next();if(o.hasClass(p.detailShow)){o.removeClass(p.detailShow);if(q.hasClass(p.detail)){q.hide()}l.raise(m.rowCollapsed,{row:r})}else{l.createOrUpdateDetailRow(r);o.addClass(p.detailShow);o.next().show();l.raise(m.rowExpanded,{row:r})}};l.getColumnFromTdIndex=function(q){var o=null;for(var r in l.columns){if(d.inArray(q,l.columns[r].matches)>=0){o=l.columns[r];break}}return o};l.createOrUpdateDetailRow=function(v){var o=d(v),q=o.next(),t,r=[];if(o.data("detail_created")===true){return true}if(o.is(":hidden")){return false}l.raise(m.rowDetailUpdating,{row:o,detail:q});o.find("> td:hidden").each(function(){var x=d(this).index(),y=l.getColumnFromTdIndex(x),w=y.name;if(y.ignore===true){return true}if(x in y.names){w=y.names[x]}r.push({name:w,value:l.parse(this,y),display:d.trim(d(this).html()),group:y.group,groupName:y.groupName});return true});if(r.length===0){return false}var u=o.find("> td:visible").length;var s=q.hasClass(p.detail);if(!s){q=d('<tr class="'+p.detail+'"><td class="'+p.detailCell+'"><div class="'+p.detailInner+'"></div></td></tr>');o.after(q)}q.find("> td:first").attr("colspan",u);t=q.find("."+p.detailInner).empty();i.createDetail(t,r,i.createGroupedDetail,i.detailSeparator,p);o.data("detail_created",true);l.raise(m.rowDetailUpdated,{row:o,detail:q});return !s};l.raise=function(o,q){if(l.options.debug===true&&d.isFunction(l.options.log)){l.options.log(o,"event")}q=q||{};var r={ft:l};d.extend(true,r,q);var s=d.Event(o,r);if(!s.ft){d.extend(true,s,r)}d(l.table).trigger(s);return s};l.init();return l}})(jQuery,window);